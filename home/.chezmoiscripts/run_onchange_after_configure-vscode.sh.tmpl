{{ if and (eq .chezmoi.os "linux") (not .headless) -}}
#!/bin/sh
set -eu
(set -o pipefail) 2>/dev/null && set -o pipefail

# ðŸ“¦ Install VS Code if missing
if ! command -v code >/dev/null 2>&1; then
    echo "âš ï¸  VS Code not found. Installing via apt..."

    # Install dependencies
    sudo apt-get update -y
    sudo apt-get install -y wget gpg apt-transport-https software-properties-common

    # Import Microsoft GPG key
    wget -qO- https://packages.microsoft.com/keys/microsoft.asc \
      | gpg --dearmor \
      | sudo tee /etc/apt/trusted.gpg.d/microsoft.gpg >/dev/null

    # Add VS Code repository
    echo "deb [arch=$(dpkg --print-architecture)] https://packages.microsoft.com/repos/code stable main" \
      | sudo tee /etc/apt/sources.list.d/vscode.list

    # Install VS Code
    sudo apt-get update -y
    sudo apt-get install -y code
else
    echo "âœ… VS Code already installed."
fi

# ðŸ”Œ Install extensions
echo "ðŸ”Œ Installing VS Code extensions..."
{{ $extensions := list
     "catppuccin.catppuccin-vsc"
     "eamodio.gitlens"
     "github.copilot"
     "github.copilot-chat"
     "github.remotehub"
     "golang.go"
     "mads-hartmann.bash-ide-vscode"
     "malmaud.tmux"
     "ms-python.debugpy"
     "ms-python.python"
     "ms-python.vscode-pylance"
     "ms-vscode-remote.remote-ssh"
     "ms-vscode-remote.remote-ssh-edit"
     "ms-vscode.remote-explorer"
     "ms-vscode.remote-repositories"
     "redhat.vscode-xml"
     "tamasfe.even-better-toml"
     "timonwong.shellcheck"
     "vscode-icons-team.vscode-icons" -}}
{{ range $extensions -}}
code --force --install-extension {{ . }}
{{ end -}}

echo "ðŸŽ‰ VS Code setup complete!"
{{ end -}}
